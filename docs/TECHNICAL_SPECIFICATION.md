# –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—å–Ω–æ–≥–æ AI —á–∞—Ç-–±–æ—Ç–∞ –Ω–∞ –±–∞–∑–µ OpenAI GPT-4

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.10.2025
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23.10.2025
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
**–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞:** –£—á–µ–±–Ω—ã–π

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è](#1-–æ–±—â–∏–µ-–ø–æ–ª–æ–∂–µ–Ω–∏—è)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#2-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
4. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#4-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
5. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#5-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
6. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#6-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
7. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#7-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
8. [API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](#8-api-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è)
9. [–ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#9-–ø–ª–∞–Ω-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
10. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](#10-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
11. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#11-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
12. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#12-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
13. [–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏](#13-–∫—Ä–∏—Ç–µ—Ä–∏–∏-–ø—Ä–∏–µ–º–∫–∏)

---

## 1. –û–ë–©–ò–ï –ü–û–õ–û–ñ–ï–ù–ò–Ø

### 1.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
–ù–∞—Å—Ç–æ—è—â–µ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–¢–ó) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —É—á–µ–±–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–∞—Ç-–±–æ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –Ω–∞ –±–∞–∑–µ OpenAI GPT-4. –î–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ–±—É—á–µ–Ω–∏—è.

### 1.2. –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–°–æ–∑–¥–∞–Ω–∏–µ **—É—á–µ–±–Ω–æ–≥–æ** —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ü—Ä–æ–µ–∫—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ ChatGPT —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

**üÜï –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏:**
- **–ë–∞–∑–∞ —á–∞—Ç–æ–≤** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- **–≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–æ–≤** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ JSON, Markdown, TXT
- **–ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏** - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —á–∞—Ç–æ–≤ –ø–æ –ø–∞–ø–∫–∞–º –∏ —Ç–µ–≥–∞–º

**üéì –£—á–µ–±–Ω—ã–µ —Ü–µ–ª–∏:**
- –ò–∑—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Modular Monolith)
- –†–∞–±–æ—Ç–∞ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–µ–∫–æ–º (Next.js 14, TypeScript, Supabase)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI API (OpenAI GPT-4)
- –ü—Ä–∞–∫—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1.3. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Modular First**: –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∫–æ–¥–∞ –∏ —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- **Security First**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Localhost First**: –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –¥–µ–ø–ª–æ—è
- **Documentation Driven**: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ –Ω–∞—á–∞–ª–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- **Environment Variables**: –í—Å–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **Clean Architecture**: –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª–µ–π
- **Test Coverage**: –ú–∏–Ω–∏–º—É–º 70% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 1.4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** - –≤—Å–µ —á–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î (–æ—Ç–ª–∏—á–∏–µ –æ—Ç ChatGPT)
- ‚ö†Ô∏è –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥ (–±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ MVP)
- ‚ö†Ô∏è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ GitHub OAuth (–¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ (Supabase, Radix UI)
- ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ –º–æ–¥—É–ª—å–Ω–æ–º –º–æ–Ω–æ–ª–∏—Ç–µ (–Ω–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ localhost:3000

---

## 2. –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### 2.1. Frontend Technologies
```yaml
Framework:
  - Next.js: 14.2.31 (App Router)
  - React: 18.2.0
  - TypeScript: 5.1.3

Styling:
  - Tailwind CSS: 3.3.2
  - CSS Modules: –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π

UI Components:
  - Radix UI: Headless –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - React Hot Toast: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - Framer Motion: –ê–Ω–∏–º–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

State Management:
  - Zustand: –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  - React Query (TanStack Query): –°–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

Utilities:
  - axios: HTTP –∫–ª–∏–µ–Ω—Ç
  - date-fns: –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
  - zod: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º
  - DOMPurify: –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML
```

### 2.2. Backend Technologies
```yaml
Runtime:
  - Node.js: 20.x LTS
  - Edge Runtime: –î–ª—è API routes (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

Architecture:
  - Modular Monolith: –ú–æ–¥—É–ª–∏ –≤–Ω—É—Ç—Ä–∏ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - Clean Architecture: –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è

Database & Auth:
  - Supabase:
    - PostgreSQL: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    - Row Level Security: –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
    - GitHub OAuth: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    - Realtime: WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

AI Integration:
  - OpenAI API: GPT-4 –º–æ–¥–µ–ª—å
  - Streaming: Server-Sent Events –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

Optional (–¥–ª—è production):
  - Upstash Redis: Rate limiting (free tier)
```

### 2.3. DevOps & Tools
```yaml
Development:
  - ESLint: –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
  - Prettier: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - Husky: Git hooks (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - tsx: TypeScript execution –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤

Testing:
  - Jest: Unit —Ç–µ—Å—Ç—ã
  - React Testing Library: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã
  - Playwright: E2E —Ç–µ—Å—Ç—ã (–ª–µ–≥—á–µ —á–µ–º Cypress –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)

Local Development:
  - npm run dev: –ó–∞–ø—É—Å–∫ –Ω–∞ localhost:3000
  - Supabase Local: –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

Deployment (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è MVP):
  - Vercel: –ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π —Å GitHub integration
  - Vercel Analytics: –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

Security:
  - Next.js Security Headers: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞
  - Zod: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - Supabase RLS: Row Level Security
```

---

## 3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

### 3.1. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Modular Monolith)

```mermaid
graph TB
    subgraph "Next.js Application (localhost:3000)"
        subgraph "Frontend Layer"
            A[React Components]
            B[Pages / App Router]
        end

        subgraph "API Layer"
            C[API Routes]
        end

        subgraph "Modules Layer"
            D[Auth Module]
            E[Chat Module]
            F[AI Module]
            G[Export Module]
            H[User Module]
            I[Search Module]
        end

        subgraph "Shared Layer"
            J[Utils & Config]
            K[Types & Interfaces]
            L[Middleware]
        end
    end

    subgraph "External Services"
        M[Supabase Auth + DB]
        N[OpenAI API]
    end

    A --> B
    B --> C
    C --> D
    C --> E
    C --> F
    C --> G
    C --> H
    C --> I

    D --> J
    E --> J
    F --> J

    D --> M
    E --> M
    F --> N
    H --> M
```

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:**
- ‚úÖ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **–æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ** Next.js (localhost:3000)
- ‚úÖ –ú–æ–¥—É–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ **—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –∏ –ø—É–±–ª–∏—á–Ω—ã–µ API**
- ‚úÖ –ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ (–±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ –û–¥–∏–Ω deployment, –æ–¥–Ω–∞ –±–∞–∑–∞ –∫–æ–¥–∞
- ‚úÖ –õ–µ–≥–∫–æ –∏–∑–≤–ª–µ—á—å –º–æ–¥—É–ª—å –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 3.2. –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

#### 3.2.1. Auth Module (`src/modules/auth/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
auth/
‚îú‚îÄ‚îÄ api/           # API handlers
‚îú‚îÄ‚îÄ services/      # AuthService, SessionService
‚îú‚îÄ‚îÄ types/         # User, Session types
‚îú‚îÄ‚îÄ hooks/         # useAuth, useSession
‚îî‚îÄ‚îÄ index.ts       # –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
```

**–§—É–Ω–∫—Ü–∏–∏:**
- GitHub OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã routes
- Logout –∏ –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

**API Endpoints:**
```
POST /api/auth/login      # –ò–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth
GET  /api/auth/callback   # OAuth callback
POST /api/auth/logout
GET  /api/auth/session
```

**–ü—É–±–ª–∏—á–Ω—ã–π API:**
```typescript
export { AuthService } from './services/AuthService';
export { useAuth, useSession } from './hooks';
export type { User, Session } from './types';
```

---

#### 3.2.2. Chat Module (`src/modules/chat/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (üî• **–Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
chat/
‚îú‚îÄ‚îÄ api/           # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —á–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ services/      # ChatService, MessageService
‚îú‚îÄ‚îÄ types/         # Chat, Message types
‚îú‚îÄ‚îÄ hooks/         # useChats, useChat
‚îú‚îÄ‚îÄ components/    # ChatList, ChatWindow, ChatMessage
‚îú‚îÄ‚îÄ store/         # Zustand store –¥–ª—è —á–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ index.ts
```

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î (–æ—Ç–ª–∏—á–∏–µ –æ—Ç ChatGPT!)
- ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —á–∞—Ç–æ–≤
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç–µ–≥–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI

**API Endpoints:**
```
GET    /api/chats              # –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /api/chats              # –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
GET    /api/chats/[id]         # –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç
PUT    /api/chats/[id]         # –û–±–Ω–æ–≤–∏—Ç—å (title, category, tags)
DELETE /api/chats/[id]         # –£–¥–∞–ª–∏—Ç—å —á–∞—Ç
POST   /api/chats/[id]/messages # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
GET    /api/chats/[id]/messages # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```

---

#### 3.2.3. AI Module (`src/modules/ai/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
ai/
‚îú‚îÄ‚îÄ api/           # Completion, streaming endpoints
‚îú‚îÄ‚îÄ services/      # OpenAIService, PromptService, StreamService
‚îú‚îÄ‚îÄ types/         # AIMessage, CompletionOptions
‚îú‚îÄ‚îÄ hooks/         # useAIStream
‚îî‚îÄ‚îÄ index.ts
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ GPT-4
- Server-Sent Events –¥–ª—è streaming –æ—Ç–≤–µ—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- Token counting
- –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥

**API Endpoints:**
```
POST /api/ai/completion   # –û–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å
POST /api/ai/stream       # Streaming –∑–∞–ø—Ä–æ—Å (SSE)
```

---

#### 3.2.4. Export Module (`src/modules/export/`) üÜï
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–æ–≤ –≤ —Ñ–∞–π–ª—ã (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏—á–∞!)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
export/
‚îú‚îÄ‚îÄ api/           # Export endpoint
‚îú‚îÄ‚îÄ services/      # ExportService, JSONExporter, MarkdownExporter, TextExporter
‚îú‚îÄ‚îÄ types/         # ExportFormat, ExportOptions
‚îî‚îÄ‚îÄ index.ts
```

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- ‚úÖ –§–æ—Ä–º–∞—Ç—ã: JSON, Markdown, TXT
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è download —Å—Å—ã–ª–æ–∫

**API Endpoints:**
```
GET /api/export/[chatId]?format=json|md|txt
GET /api/export/all?format=json
```

---

#### 3.2.5. Search Module (`src/modules/search/`) üÜï
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
search/
‚îú‚îÄ‚îÄ api/           # Search endpoint
‚îú‚îÄ‚îÄ services/      # SearchService (full-text search)
‚îú‚îÄ‚îÄ types/         # SearchQuery, SearchResult
‚îú‚îÄ‚îÄ components/    # SearchBar, SearchResults
‚îî‚îÄ‚îÄ index.ts
```

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/—Ç–µ–≥–∞–º
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**API Endpoints:**
```
GET /api/search?q=typescript&category=study
```

---

#### 3.2.6. User Module (`src/modules/user/`)
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
user/
‚îú‚îÄ‚îÄ api/           # Profile, settings, stats
‚îú‚îÄ‚îÄ services/      # UserService, StatsService
‚îú‚îÄ‚îÄ types/         # UserProfile, Settings
‚îú‚îÄ‚îÄ hooks/         # useUser, useSettings
‚îú‚îÄ‚îÄ components/    # ProfileCard, SettingsPanel
‚îî‚îÄ‚îÄ index.ts
```

**–§—É–Ω–∫—Ü–∏–∏:**
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ç–µ–º–∞, —è–∑—ã–∫, –º–æ–¥–µ–ª—å AI)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è MVP)

**API Endpoints:**
```
GET /api/users/profile
PUT /api/users/profile
GET /api/users/settings
PUT /api/users/settings
```

### 3.3. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π

#### –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```
1. User clicks "Login with GitHub"
   ‚Üì
2. Frontend ‚Üí Auth Module API (/api/auth/login)
   ‚Üì
3. Auth Module ‚Üí Supabase Auth (OAuth redirect)
   ‚Üì
4. GitHub OAuth ‚Üí User authorizes ‚Üí Callback
   ‚Üì
5. Supabase Auth ‚Üí Auth Module (/api/auth/callback)
   ‚Üì
6. Auth Module creates session ‚Üí Frontend
   ‚Üì
7. Frontend saves session in cookies ‚Üí Redirect to /chats
```

#### –ü–æ—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
1. User types message in ChatInput
   ‚Üì
2. Frontend ‚Üí Chat Module API
   POST /api/chats/[id]/messages
   Body: { content: "Hello AI", role: "user" }
   ‚Üì
3. Chat Module:
   - AuthService.getCurrentUser() ‚Üê Auth Module
   - MessageService.save(message) ‚Üí Supabase DB
   ‚Üì
4. Chat Module ‚Üí AI Module
   AIService.getCompletion(messages[])
   ‚Üì
5. AI Module ‚Üí OpenAI API (GPT-4)
   Stream response via SSE
   ‚Üì
6. AI Module streams chunks ‚Üí Frontend
   data: {"chunk": "Hello"}
   data: {"chunk": " there"}
   data: {"done": true}
   ‚Üì
7. Chat Module saves AI response ‚Üí Supabase DB
   ‚Üì
8. Frontend updates UI with complete message
```

#### –ü–æ—Ç–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ —á–∞—Ç–∞:
```
1. User clicks "Export as Markdown"
   ‚Üì
2. Frontend ‚Üí Export Module API
   GET /api/export/[chatId]?format=md
   ‚Üì
3. Export Module:
   - ChatService.getChat(chatId) ‚Üê Chat Module
   - MarkdownExporter.export(chat)
   ‚Üì
4. Export Module ‚Üí Frontend
   Response: markdown file download
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
- ‚úÖ –ú–æ–¥—É–ª–∏ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ API (index.ts)
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: Auth ‚Üí Chat ‚Üí AI, Export, Search
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–æ–¥—É–ª–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ

---

## 4. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 4.1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### 4.1.1. OAuth 2.0 Flow
```typescript
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub OAuth
const authConfig = {
  provider: 'github',
  scope: ['read:user', 'user:email'],
  redirectUrl: process.env.NEXT_PUBLIC_REDIRECT_URL,
  clientId: process.env.GITHUB_CLIENT_ID,
  clientSecret: process.env.GITHUB_CLIENT_SECRET // —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
}
```

#### 4.1.2. JWT Token Structure
```typescript
interface JWTPayload {
  sub: string;          // user ID
  email: string;
  name: string;
  avatar_url?: string;
  iat: number;          // issued at
  exp: number;          // expiration (15 min)
  refresh_token: string; // –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

#### 4.1.3. Session Management
- –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ httpOnly cookies
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ access token: 15 –º–∏–Ω—É—Ç
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ refresh token: 7 –¥–Ω–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ logout

### 4.2. –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∏–¥–æ–≤ –∞—Ç–∞–∫

#### 4.2.1. XSS (Cross-Site Scripting)
```typescript
// –ú–µ—Ä—ã –∑–∞—â–∏—Ç—ã:
1. Content Security Policy (CSP):
   "default-src 'self'; 
    script-src 'self' 'unsafe-inline' 'unsafe-eval'; 
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    connect-src 'self' https://api.openai.com https://*.supabase.co;"

2. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   import DOMPurify from 'dompurify';
   const clean = DOMPurify.sanitize(userInput);

3. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ React –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç
   - –ò–∑–±–µ–≥–∞—Ç—å dangerouslySetInnerHTML

4. HttpOnly cookies –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
```

#### 4.2.2. SQL Injection
```typescript
// –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Supabase:
1. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
   const { data } = await supabase
     .from('messages')
     .select('*')
     .eq('user_id', userId) // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è

2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Å Zod:
   const messageSchema = z.object({
     content: z.string().max(10000),
     role: z.enum(['user', 'assistant'])
   });

3. Row Level Security (RLS) policies
```

#### 4.2.3. CSRF (Cross-Site Request Forgery)
```typescript
// –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ä—ã:
1. CSRF —Ç–æ–∫–µ–Ω—ã –¥–ª—è –º—É—Ç–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. SameSite cookie attribute: 'strict'
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Origin –∏ Referer headers
4. Double Submit Cookie pattern
```

#### 4.2.4. Rate Limiting
```typescript
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è rate limiter:
const rateLimitConfig = {
  windowMs: 15 * 60 * 1000,  // 15 –º–∏–Ω—É—Ç
  max: 100,                   // –º–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
  message: 'Too many requests',
  standardHeaders: true,
  legacyHeaders: false,
  
  // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã:
  ai: {
    windowMs: 60 * 1000,      // 1 –º–∏–Ω—É—Ç–∞
    max: 10                   // 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AI
  }
}
```

### 4.3. HTTP Security Headers
```javascript
// next.config.js
const securityHeaders = [
  {
    key: 'X-DNS-Prefetch-Control',
    value: 'on'
  },
  {
    key: 'Strict-Transport-Security',
    value: 'max-age=63072000; includeSubDomains; preload'
  },
  {
    key: 'X-Frame-Options',
    value: 'DENY'
  },
  {
    key: 'X-Content-Type-Options',
    value: 'nosniff'
  },
  {
    key: 'X-XSS-Protection',
    value: '1; mode=block'
  },
  {
    key: 'Referrer-Policy',
    value: 'strict-origin-when-cross-origin'
  },
  {
    key: 'Permissions-Policy',
    value: 'camera=(), microphone=(), geolocation=()'
  },
  {
    key: 'Content-Security-Policy',
    value: ContentSecurityPolicy
  }
];

module.exports = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: securityHeaders,
      },
    ]
  },
}
```

### 4.4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### 4.4.1. Input Validation Schema
```typescript
import { z } from 'zod';

// –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
export const schemas = {
  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  loginSchema: z.object({
    email: z.string().email().max(255),
    password: z.string().min(6).max(100)
  }),

  // –°–æ–æ–±—â–µ–Ω–∏—è
  messageSchema: z.object({
    content: z.string().min(1).max(10000),
    role: z.enum(['user', 'assistant', 'system'])
  }),

  // ID –≤–∞–ª–∏–¥–∞—Ü–∏—è
  uuidSchema: z.string().uuid(),
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  settingsSchema: z.object({
    theme: z.enum(['light', 'dark', 'system']),
    language: z.enum(['en', 'ru']),
    model: z.enum(['gpt-4', 'gpt-3.5-turbo'])
  })
};

// Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
export const validateRequest = (schema: ZodSchema) => {
  return async (req: Request) => {
    try {
      const body = await req.json();
      return schema.parse(body);
    } catch (error) {
      throw new ValidationError(error);
    }
  };
};
```

#### 4.4.2. Output Sanitization
```typescript
// –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç AI
export const sanitizeAIResponse = (response: string): string => {
  // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  const cleaned = DOMPurify.sanitize(response, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'code', 'pre'],
    ALLOWED_ATTR: []
  });
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–Ω—ä–µ–∫—Ü–∏–∏
  const injectionPatterns = [
    /<script/gi,
    /javascript:/gi,
    /on\w+=/gi
  ];
  
  for (const pattern of injectionPatterns) {
    if (pattern.test(cleaned)) {
      throw new SecurityError('Potential injection detected');
    }
  }
  
  return cleaned;
};
```

### 4.5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

#### 4.5.1. Environment Variables Structure
```bash
# .env.local (–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!)

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx

# OpenAI
OPENAI_API_KEY=sk-xxx
OPENAI_ORG_ID=org-xxx

# GitHub OAuth
GITHUB_CLIENT_ID=xxx
GITHUB_CLIENT_SECRET=xxx

# Security
JWT_SECRET=xxx # –ú–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
ENCRYPTION_KEY=xxx # –î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è sensitive –¥–∞–Ω–Ω—ã—Ö
CSRF_SECRET=xxx

# Application
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è rate limiting)
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=xxx

# Monitoring (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è production)
SENTRY_DSN=https://xxx@sentry.io/xxx
NEXT_PUBLIC_SENTRY_DSN=https://xxx@sentry.io/xxx
```

#### 4.5.2. Secrets Management Best Practices
```yaml
Development:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env.local
  - –î–æ–±–∞–≤–∏—Ç—å .env* –≤ .gitignore
  - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å .env.example —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏

Staging/Production:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Vercel Env Variables)
  - –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π
  - –ê—É–¥–∏—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–∫—Ä–µ—Ç–∞–º
  - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–∫–æ–µ

CI/CD:
  - GitHub Secrets –¥–ª—è Actions
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ä–µ—Ç–∞–º
  - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö
```

---

## 5. –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 5.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (User Stories)

#### 5.1.1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```gherkin
Feature: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ GitHub

Scenario: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
  Given –Ø –Ω–∞—Ö–æ–∂—É—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞
  When –Ø –Ω–∞–∂–∏–º–∞—é "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ GitHub"
  And –Ø –∞–≤—Ç–æ—Ä–∏–∑—É—é—Å—å –≤ GitHub
  Then –Ø –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–∞—Ç–∞
  And –Ø –≤–∏–∂—É —Å–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

Scenario: –û—Ç–∫–∞–∑ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  Given –Ø –Ω–∞—Ö–æ–∂—É—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞
  When –Ø –Ω–∞–∂–∏–º–∞—é "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ GitHub"
  And –Ø –æ—Ç–º–µ–Ω—è—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
  Then –Ø –æ—Å—Ç–∞—é—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞
  And –í–∏–∂—É —Å–æ–æ–±—â–µ–Ω–∏–µ "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
```

#### 5.1.2. –ß–∞—Ç —Å AI
```gherkin
Feature: –û–±—â–µ–Ω–∏–µ —Å AI

Scenario: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  Given –Ø –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  And –Ø –Ω–∞—Ö–æ–∂—É—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —á–∞—Ç–∞
  When –Ø –≤–≤–æ–∂—É "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"
  And –ù–∞–∂–∏–º–∞—é Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
  Then –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç–µ
  And –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "AI –ø–µ—á–∞—Ç–∞–µ—Ç..."
  And –Ø –ø–æ–ª—É—á–∞—é –æ—Ç–≤–µ—Ç –æ—Ç AI

Scenario: –õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
  Given –£ –º–µ–Ω—è –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
  When –Ø –ø—ã—Ç–∞—é—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  Then –í–∏–∂—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–∏–º–∏—Ç–µ
  And –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
```

### 5.2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏

#### 5.2.1. –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| GitHub OAuth | –í—Ö–æ–¥ —á–µ—Ä–µ–∑ GitHub –∞–∫–∫–∞—É–Ω—Ç | –í—ã—Å–æ–∫–∏–π |
| –°–µ—Å—Å–∏–∏ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Å—Å–∏–π 7 –¥–Ω–µ–π | –í—ã—Å–æ–∫–∏–π |
| Logout | –í—ã—Ö–æ–¥ –∏ –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏ | –í—ã—Å–æ–∫–∏–π |
| Auto-refresh | –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ | –°—Ä–µ–¥–Ω–∏–π |
| Remember me | –ó–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ù–∏–∑–∫–∏–π |

#### 5.2.2. –ú–æ–¥—É–ª—å —á–∞—Ç–∞ (üÜï —Å –∏—Å—Ç–æ—Ä–∏–µ–π)
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| **–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–æ–≤** | –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å AI | **–í—ã—Å–æ–∫–∏–π** |
| **–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤** | –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (–æ—Ç–ª–∏—á–∏–µ –æ—Ç ChatGPT!) | **–í—ã—Å–æ–∫–∏–π** |
| –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ 10000 —Å–∏–º–≤–æ–ª–æ–≤ | –í—ã—Å–æ–∫–∏–π |
| –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ | Streaming –æ—Ç–≤–µ—Ç—ã –æ—Ç AI | –í—ã—Å–æ–∫–∏–π |
| **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** | AI —Å–æ–∑–¥–∞—ë—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ | **–°—Ä–µ–¥–Ω–∏–π** |
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ | –ü–æ–∫–∞–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | –í—ã—Å–æ–∫–∏–π |
| –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ | –°—Ä–µ–¥–Ω–∏–π |
| –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ | –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ | –°—Ä–µ–¥–Ω–∏–π |
| –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç | –°—Ä–µ–¥–Ω–∏–π |
| **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç–µ–≥–∏** | –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —á–∞—Ç–æ–≤ | **–°—Ä–µ–¥–Ω–∏–π** |
| –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ | –ü–æ–∫–∞–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤ | –ù–∏–∑–∫–∏–π |

#### 5.2.3. –ú–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∞ (üÜï —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏—á–∞)
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| **–≠–∫—Å–ø–æ—Ä—Ç JSON** | –°–∫–∞—á–∞—Ç—å —á–∞—Ç –≤ JSON | **–í—ã—Å–æ–∫–∏–π** |
| **–≠–∫—Å–ø–æ—Ä—Ç Markdown** | –°–∫–∞—á–∞—Ç—å —á–∞—Ç –≤ Markdown | **–í—ã—Å–æ–∫–∏–π** |
| **–≠–∫—Å–ø–æ—Ä—Ç TXT** | –°–∫–∞—á–∞—Ç—å —á–∞—Ç –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ | –°—Ä–µ–¥–Ω–∏–π |
| –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —á–∞—Ç–æ–≤ | –ê—Ä—Ö–∏–≤ –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤ | –ù–∏–∑–∫–∏–π |

#### 5.2.4. –ú–æ–¥—É–ª—å –ø–æ–∏—Å–∫–∞ (üÜï —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏—á–∞)
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** | –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è–º | **–°—Ä–µ–¥–Ω–∏–π** |
| –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º | –ü–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | –°—Ä–µ–¥–Ω–∏–π |
| –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | Highlight –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ | –ù–∏–∑–∫–∏–π |

#### 5.2.5. –ú–æ–¥—É–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã | –°—Ä–µ–¥–Ω–∏–π |
| –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | EN/RU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –ù–∏–∑–∫–∏–π |
| –ú–æ–¥–µ–ª—å AI | –í—ã–±–æ—Ä GPT –º–æ–¥–µ–ª–∏ | –ù–∏–∑–∫–∏–π |

### 5.3. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)

#### 5.3.1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```yaml
–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–¥–ª—è localhost):
  - First Contentful Paint (FCP): < 2s
  - Time to Interactive (TTI): < 4s
  - API Response Time: < 1s (–±–µ–∑ AI)
  - AI Response Start: < 3s
  - Concurrent Users: 10-20 (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
  - React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å memo
  - Lazy loading –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - Pagination –¥–ª—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ (>100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
```

#### 5.3.2. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
```yaml
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
  - Graceful error handling (–∫—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö)
  - Loading states –¥–ª—è –≤—Å–µ—Ö async –æ–ø–µ—Ä–∞—Ü–∏–π
  - Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è OpenAI API (1 retry)
  - Fallback UI –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
```

#### 5.3.3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
```yaml
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
  - –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ª–µ–≥–∫–æ –∏–∑–≤–ª–µ—á—å –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
  - Database connection pooling (Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  - Stateless API routes (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é)

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è MVP –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
```

#### 5.3.4. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
```yaml
–ë—Ä–∞—É–∑–µ—Ä—ã:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
  
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
  - Desktop: 1280px+
  - Tablet: 768px - 1279px
  - Mobile: 320px - 767px
  
–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
  - WCAG 2.1 Level AA
  - Keyboard navigation
  - Screen reader support
```

---

## 6. –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### 6.1. –ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
ai-chatbot/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/                          # Next.js Frontend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                      # App Router
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (auth)/              # Auth –≥—Ä—É–ø–ø–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (chat)/              # Chat –≥—Ä—É–ø–ø–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                 # API Routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/              # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatInput.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatMessage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatWindow.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                  # –ë–∞–∑–æ–≤—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                     # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                   # Custom hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useChat.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/                   # Zustand store
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chat.store.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/                  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ public/                  # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.ts            # Next.js middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ auth-service/                # Auth –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ chat-service/                # Chat –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ai-service/                  # AI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ openai.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompt.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ user-service/                # User –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ tests/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ packages/                        # Shared packages
‚îÇ   ‚îú‚îÄ‚îÄ shared/                     # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ui/                         # Shared UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/                   # Database —Å—Ö–µ–º—ã –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seeds/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.sql
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ config/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ eslint-config/
‚îÇ       ‚îú‚îÄ‚îÄ typescript-config/
‚îÇ       ‚îî‚îÄ‚îÄ tailwind-config/
‚îÇ
‚îú‚îÄ‚îÄ docs/                           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ API.md                     # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md            # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ SECURITY.md                # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md              # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ CONTRIBUTING.md            # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ diagrams/                  # –î–∏–∞–≥—Ä–∞–º–º—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/                        # –°–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ setup.sh                   # –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ dev.sh                     # –ó–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ build.sh                   # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ test.sh                    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ deploy.sh                  # –î–µ–ø–ª–æ–π
‚îÇ
‚îú‚îÄ‚îÄ .github/                        # GitHub –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ci.yml                # Continuous Integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cd.yml                # Continuous Deployment
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.yml          # Security checks
‚îÇ   ‚îú‚îÄ‚îÄ ISSUE_TEMPLATE/
‚îÇ   ‚îî‚îÄ‚îÄ PULL_REQUEST_TEMPLATE.md
‚îÇ
‚îú‚îÄ‚îÄ .docker/                        # Docker —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îî‚îÄ‚îÄ redis/
‚îÇ       ‚îî‚îÄ‚îÄ redis.conf
‚îÇ
‚îú‚îÄ‚îÄ tests/                          # E2E —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îî‚îÄ‚îÄ integration/
‚îÇ
‚îú‚îÄ‚îÄ .vscode/                        # VS Code –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ settings.json
‚îÇ   ‚îú‚îÄ‚îÄ launch.json
‚îÇ   ‚îî‚îÄ‚îÄ extensions.json
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml              # Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ docker-compose.prod.yml         # Docker Compose –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
‚îú‚îÄ‚îÄ .env.example                    # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore                      # Git ignore —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .prettierrc                     # Prettier –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .eslintrc.js                    # ESLint –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ jest.config.js                  # Jest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ turbo.json                      # Turborepo –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ package.json                    # Root package.json
‚îú‚îÄ‚îÄ pnpm-workspace.yaml             # PNPM workspace
‚îú‚îÄ‚îÄ TODO.md                         # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ CHANGELOG.md                    # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ LICENSE                         # –õ–∏—Ü–µ–Ω–∑–∏—è
‚îî‚îÄ‚îÄ README.md                       # –ì–ª–∞–≤–Ω—ã–π README
```

### 6.2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### 6.2.1. Root package.json
```json
{
  "name": "ai-chatbot",
  "version": "1.0.0",
  "private": true,
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "dev": "turbo run dev",
    "build": "turbo run build",
    "test": "turbo run test",
    "lint": "turbo run lint",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "prepare": "husky install"
  },
  "devDependencies": {
    "turbo": "latest",
    "prettier": "latest",
    "husky": "latest",
    "@commitlint/cli": "latest",
    "@commitlint/config-conventional": "latest"
  },
  "engines": {
    "node": ">=20.0.0",
    "pnpm": ">=8.0.0"
  }
}
```

#### 6.2.2. docker-compose.yml
```yaml
version: '3.9'

services:
  # Frontend
  web:
    build: ./apps/web
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
    env_file:
      - .env.local
    volumes:
      - ./apps/web:/app
      - /app/node_modules
    depends_on:
      - auth-service
      - chat-service
      - ai-service
      - user-service

  # Microservices
  auth-service:
    build: ./apps/auth-service
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
    env_file:
      - .env.local
    volumes:
      - ./apps/auth-service:/app
      - /app/node_modules

  chat-service:
    build: ./apps/chat-service
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
    env_file:
      - .env.local
    volumes:
      - ./apps/chat-service:/app
      - /app/node_modules
    depends_on:
      - redis

  ai-service:
    build: ./apps/ai-service
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
    env_file:
      - .env.local
    volumes:
      - ./apps/ai-service:/app
      - /app/node_modules
    depends_on:
      - redis

  user-service:
    build: ./apps/user-service
    ports:
      - "3004:3004"
    environment:
      - NODE_ENV=development
    env_file:
      - .env.local
    volumes:
      - ./apps/user-service:/app
      - /app/node_modules

  # Redis cache
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

  # Nginx (optional for production-like env)
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./.docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web

volumes:
  redis_data:
```

---

## 7. –ë–ê–ó–ê –î–ê–ù–ù–´–•

### 7.1. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Users table (managed by Supabase Auth)
-- –†–∞—Å—à–∏—Ä—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É auth.users

-- User profiles table
CREATE TABLE public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  username VARCHAR(50) UNIQUE,
  full_name VARCHAR(100),
  avatar_url TEXT,
  github_username VARCHAR(50),
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- User sessions (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π)
CREATE TABLE public.sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  token_hash VARCHAR(255) NOT NULL UNIQUE,
  ip_address INET,
  user_agent TEXT,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_activity TIMESTAMPTZ DEFAULT NOW(),
  
  INDEX idx_sessions_user_id (user_id),
  INDEX idx_sessions_token (token_hash),
  INDEX idx_sessions_expires (expires_at)
);

-- Chat messages (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
CREATE TABLE public.chat_messages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  tokens_used INTEGER,
  model VARCHAR(50),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  INDEX idx_messages_user_id (user_id),
  INDEX idx_messages_created (created_at)
);

-- Usage statistics
CREATE TABLE public.usage_stats (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  messages_count INTEGER DEFAULT 0,
  tokens_used INTEGER DEFAULT 0,
  ai_requests_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id, date),
  INDEX idx_usage_user_date (user_id, date)
);

-- Rate limiting
CREATE TABLE public.rate_limits (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  endpoint VARCHAR(100) NOT NULL,
  requests_count INTEGER DEFAULT 0,
  window_start TIMESTAMPTZ NOT NULL,
  window_end TIMESTAMPTZ NOT NULL,
  
  UNIQUE(user_id, endpoint, window_start),
  INDEX idx_rate_limits_user_endpoint (user_id, endpoint),
  INDEX idx_rate_limits_window (window_end)
);

-- Audit logs
CREATE TABLE public.audit_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES public.profiles(id) ON DELETE SET NULL,
  action VARCHAR(100) NOT NULL,
  entity_type VARCHAR(50),
  entity_id UUID,
  changes JSONB,
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  INDEX idx_audit_user_id (user_id),
  INDEX idx_audit_action (action),
  INDEX idx_audit_created (created_at)
);
```

### 7.2. Row Level Security (RLS) Policies

```sql
-- Enable RLS
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.chat_messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.usage_stats ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.rate_limits ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.audit_logs ENABLE ROW LEVEL SECURITY;

-- Profiles policies
CREATE POLICY "Users can view own profile" 
  ON public.profiles FOR SELECT 
  USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" 
  ON public.profiles FOR UPDATE 
  USING (auth.uid() = id);

-- Sessions policies
CREATE POLICY "Users can view own sessions" 
  ON public.sessions FOR SELECT 
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own sessions" 
  ON public.sessions FOR DELETE 
  USING (auth.uid() = user_id);

-- Chat messages policies
CREATE POLICY "Users can view own messages" 
  ON public.chat_messages FOR SELECT 
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own messages" 
  ON public.chat_messages FOR INSERT 
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can delete own messages" 
  ON public.chat_messages FOR DELETE 
  USING (auth.uid() = user_id);

-- Usage stats policies
CREATE POLICY "Users can view own stats" 
  ON public.usage_stats FOR SELECT 
  USING (auth.uid() = user_id);

-- Rate limits policies  
CREATE POLICY "Users can view own rate limits" 
  ON public.rate_limits FOR SELECT 
  USING (auth.uid() = user_id);

-- Audit logs policies (read-only for users)
CREATE POLICY "Users can view own audit logs" 
  ON public.audit_logs FOR SELECT 
  USING (auth.uid() = user_id);
```

### 7.3. Database Functions –∏ Triggers

```sql
-- Function –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ language 'plpgsql';

-- Triggers –¥–ª—è updated_at
CREATE TRIGGER update_profiles_updated_at 
  BEFORE UPDATE ON public.profiles 
  FOR EACH ROW 
  EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_usage_stats_updated_at 
  BEFORE UPDATE ON public.usage_stats 
  FOR EACH ROW 
  EXECUTE FUNCTION update_updated_at_column();

-- Function –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π
CREATE OR REPLACE FUNCTION cleanup_expired_sessions()
RETURNS void AS $$
BEGIN
  DELETE FROM public.sessions 
  WHERE expires_at < NOW();
END;
$$ language 'plpgsql';

-- Function –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
CREATE OR REPLACE FUNCTION increment_usage_stats(
  p_user_id UUID,
  p_tokens INTEGER,
  p_is_ai_request BOOLEAN DEFAULT FALSE
)
RETURNS void AS $$
BEGIN
  INSERT INTO public.usage_stats (user_id, date, messages_count, tokens_used, ai_requests_count)
  VALUES (
    p_user_id, 
    CURRENT_DATE, 
    1, 
    p_tokens,
    CASE WHEN p_is_ai_request THEN 1 ELSE 0 END
  )
  ON CONFLICT (user_id, date) DO UPDATE
  SET 
    messages_count = usage_stats.messages_count + 1,
    tokens_used = usage_stats.tokens_used + p_tokens,
    ai_requests_count = usage_stats.ai_requests_count + 
      CASE WHEN p_is_ai_request THEN 1 ELSE 0 END;
END;
$$ language 'plpgsql';
```

---

## 8. API –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø

### 8.1. RESTful API Endpoints

#### 8.1.1. Authentication Service API

```typescript
/**
 * POST /api/auth/login
 * –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç OAuth flow
 */
interface LoginRequest {
  provider: 'github';
  redirectUrl?: string;
}

interface LoginResponse {
  authUrl: string;
}

/**
 * POST /api/auth/callback
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ OAuth callback
 */
interface CallbackRequest {
  code: string;
  state: string;
}

interface CallbackResponse {
  user: {
    id: string;
    email: string;
    name: string;
    avatar_url?: string;
  };
  session: {
    access_token: string;
    refresh_token: string;
    expires_in: number;
  };
}

/**
 * POST /api/auth/refresh
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
 */
interface RefreshRequest {
  refresh_token: string;
}

interface RefreshResponse {
  access_token: string;
  expires_in: number;
}

/**
 * POST /api/auth/logout
 * –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
 */
interface LogoutRequest {
  everywhere?: boolean; // –í—ã–π—Ç–∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
}

/**
 * GET /api/auth/session
 * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
 */
interface SessionResponse {
  user: {
    id: string;
    email: string;
    name: string;
    avatar_url?: string;
  } | null;
  expires_at?: string;
}
```

#### 8.1.2. Chat Service API

```typescript
/**
 * POST /api/chat/message
 * –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
 */
interface SendMessageRequest {
  content: string;
  context?: Message[]; // –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
}

interface Message {
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp?: string;
}

interface SendMessageResponse {
  id: string;
  role: 'assistant';
  content: string;
  tokens_used: number;
  model: string;
  created_at: string;
}

/**
 * GET /api/chat/history
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
 */
interface HistoryResponse {
  messages: Message[];
  total_tokens: number;
}

/**
 * DELETE /api/chat/clear
 * –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
 */
interface ClearChatResponse {
  success: boolean;
  message: string;
}

/**
 * POST /api/chat/export
 * –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
 */
interface ExportRequest {
  format: 'json' | 'txt' | 'md';
}

interface ExportResponse {
  download_url: string;
  expires_at: string;
}
```

#### 8.1.3. AI Service API

```typescript
/**
 * POST /api/ai/completion
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI
 */
interface CompletionRequest {
  messages: Message[];
  model?: 'gpt-4' | 'gpt-3.5-turbo';
  temperature?: number; // 0-2, default 0.7
  max_tokens?: number; // default 2000
  stream?: boolean; // default true
}

interface CompletionResponse {
  id: string;
  content: string;
  model: string;
  tokens: {
    prompt: number;
    completion: number;
    total: number;
  };
  created_at: string;
}

/**
 * POST /api/ai/stream
 * Server-Sent Events –¥–ª—è streaming
 */
// Event stream format:
// data: {"chunk": "Hello", "id": "msg-123"}
// data: {"chunk": " world", "id": "msg-123"}
// data: {"done": true, "tokens": {...}}

/**
 * GET /api/ai/models
 * –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
 */
interface ModelsResponse {
  models: Array<{
    id: string;
    name: string;
    max_tokens: number;
    available: boolean;
  }>;
}

/**
 * POST /api/ai/validate-prompt
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
 */
interface ValidatePromptRequest {
  content: string;
}

interface ValidatePromptResponse {
  valid: boolean;
  issues?: string[];
  estimated_tokens: number;
}
```

#### 8.1.4. User Service API

```typescript
/**
 * GET /api/users/profile
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
 */
interface ProfileResponse {
  id: string;
  username?: string;
  full_name?: string;
  email: string;
  avatar_url?: string;
  github_username?: string;
  settings: UserSettings;
  created_at: string;
}

/**
 * PUT /api/users/profile
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
 */
interface UpdateProfileRequest {
  username?: string;
  full_name?: string;
  avatar_url?: string;
}

/**
 * GET /api/users/settings
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 */
interface UserSettings {
  theme: 'light' | 'dark' | 'system';
  language: 'en' | 'ru';
  model: 'gpt-4' | 'gpt-3.5-turbo';
  notifications: boolean;
}

/**
 * PUT /api/users/settings
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
 */
interface UpdateSettingsRequest extends Partial<UserSettings> {}

/**
 * GET /api/users/stats
 * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
 */
interface StatsResponse {
  usage: {
    messages_today: number;
    messages_total: number;
    tokens_today: number;
    tokens_total: number;
  };
  limits: {
    messages_per_day: number;
    tokens_per_day: number;
    remaining_messages: number;
    remaining_tokens: number;
    resets_at: string;
  };
}
```

### 8.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
interface ErrorResponse {
  error: {
    code: string;
    message: string;
    details?: any;
    timestamp: string;
    path: string;
  };
}

// –ö–æ–¥—ã –æ—à–∏–±–æ–∫
enum ErrorCodes {
  // Auth errors (4xx)
  UNAUTHORIZED = 'AUTH001',
  INVALID_TOKEN = 'AUTH002',
  TOKEN_EXPIRED = 'AUTH003',
  INSUFFICIENT_PERMISSIONS = 'AUTH004',
  
  // Validation errors (4xx)
  VALIDATION_ERROR = 'VAL001',
  INVALID_INPUT = 'VAL002',
  MESSAGE_TOO_LONG = 'VAL003',
  
  // Rate limit errors (429)
  RATE_LIMIT_EXCEEDED = 'RATE001',
  QUOTA_EXCEEDED = 'RATE002',
  
  // AI errors (5xx)
  AI_SERVICE_ERROR = 'AI001',
  AI_SERVICE_UNAVAILABLE = 'AI002',
  AI_RESPONSE_ERROR = 'AI003',
  
  // Server errors (5xx)
  INTERNAL_ERROR = 'SRV001',
  DATABASE_ERROR = 'SRV002',
  SERVICE_UNAVAILABLE = 'SRV003'
}
```

### 8.3. WebSocket Events (–¥–ª—è real-time —Ñ—É–Ω–∫—Ü–∏–π)

```typescript
// Client -> Server events
interface ClientEvents {
  'message:send': {
    content: string;
  };
  'message:typing': {
    isTyping: boolean;
  };
  'chat:clear': {};
}

// Server -> Client events
interface ServerEvents {
  'message:new': {
    message: Message;
  };
  'message:stream': {
    chunk: string;
    messageId: string;
  };
  'message:complete': {
    messageId: string;
    tokens: number;
  };
  'error': {
    code: string;
    message: string;
  };
  'user:typing': {
    userId: string;
    isTyping: boolean;
  };
}
```

---

## 9. –ü–õ–ê–ù –†–ê–ó–†–ê–ë–û–¢–ö–ò

### 9.1. –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Roadmap)

```mermaid
gantt
    title –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ AI Chatbot
    dateFormat  YYYY-MM-DD
    
    section –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è           :done, prep1, 2025-01-01, 1d
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è            :done, prep2, after prep1, 2d
    –ù–∞–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏         :active, prep3, after prep2, 3d
    –°–æ–∑–¥–∞–Ω–∏–µ TODO.md               :prep4, after prep3, 1d
    
    section –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    Docker setup                   :infra1, after prep4, 2d
    Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è         :infra2, after infra1, 2d
    GitHub OAuth setup             :infra3, after infra2, 1d
    CI/CD pipeline                 :infra