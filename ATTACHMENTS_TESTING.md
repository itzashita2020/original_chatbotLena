# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (2025-10-25)
**–ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: RLS –æ—à–∏–±–∫–∞**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π messageId, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ user message –≤ –ë–î –ü–ï–†–ï–î –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: attachmentUrls –ø—É—Å—Ç–æ–π**
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ —É–¥–∞–≤–∞–ª–∞—Å—å –∏–∑-–∑–∞ RLS –æ—à–∏–±–∫–∏
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º messageId

### ‚úÖ 1.5. MIME Type Fallback (2025-10-26)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä—ã –∏–Ω–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç CSV/JSON —Ñ–∞–π–ª—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME —Ç–∏–ø–æ–º
- CSV –º–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ `application/octet-stream` –≤–º–µ—Å—Ç–æ `text/csv`
- JSON –º–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ `application/json`
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ fallback –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –ï—Å–ª–∏ MIME —Ç–∏–ø –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω (`application/octet-stream` –∏–ª–∏ –ø—É—Å—Ç–æ–π), —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø

### ‚úÖ 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (2025-10-26)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª—å `gpt-4-vision-preview` —É—Å—Ç–∞—Ä–µ–ª–∞ (404 error)
- **–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ `gpt-4o` (–Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

### ‚úÖ 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (2025-10-26)
**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: `pdf2json` (–∑–∞–º–µ–Ω–∞ `pdf-parse`), `mammoth`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF, DOCX, DOC, TXT, MD, CSV, JSON, XML, HTML
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏** –¥–ª—è CSV (UTF-8 ‚Üí Windows-1251)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ `message_attachments.metadata.extracted_text`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–µ–∫—Å—Ç–∞ –≤ AI –ø—Ä–æ–º–ø—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ `gpt-4o`** –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (128k –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ 8k)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
- üìÑ **PDF —Å —Ç–µ–∫—Å—Ç–æ–º** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ `pdf2json` ‚úÖ
- üìÑ **PDF-—Å–∫–∞–Ω—ã** - –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚ö†Ô∏è
- üìù **DOCX** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `mammoth` ‚úÖ
- üìù **DOC** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ `mammoth` ‚úÖ

**–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- üìÉ **TXT** - –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ ‚úÖ
- üìù **Markdown (.md)** - –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ ‚úÖ
- üìä **JSON** - —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ ‚úÖ
- üìà **CSV** - —Ç–∞–±–ª–∏—Ü—ã –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚úÖ
- üìã **XML** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚úÖ
- üåê **HTML** - –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚úÖ

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- üñºÔ∏è **JPG, PNG, GIF, WebP** - Vision —á–µ—Ä–µ–∑ `gpt-4o` —Å OCR ‚úÖ

**–†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. ‚úÖ `pdf-parse` –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Next.js ‚Üí –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `pdf2json`
2. ‚úÖ –û—à–∏–±–∫–∞ "maximum context length 8192 tokens" ‚Üí –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ `gpt-4o`
3. ‚úÖ –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF ‚Üí –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –û—Ç–∫–ª—é—á–∏—Ç—å RLS (–≤—Ä–µ–º–µ–Ω–Ω–æ)

–¢–∞–∫ –∫–∞–∫ auth –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `message_attachments`:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `DISABLE_RLS_FOR_TESTING.sql`:

```sql
ALTER TABLE message_attachments DISABLE ROW LEVEL SECURITY;
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∫–ª—é—á–∏—Ç—å RLS –æ–±—Ä–∞—Ç–Ω–æ, –∫–æ–≥–¥–∞ auth –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω!

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Storage Policies

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ **Storage ‚Üí chat-attachments ‚Üí Policies** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

#### Policy 1: INSERT
```sql
CREATE POLICY "Authenticated users can upload"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'chat-attachments'
  AND (auth.role() = 'authenticated' OR auth.role() = 'anon')
);
```

‚ö†Ô∏è **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –í—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º `anon` —Ä–æ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã

#### Policy 2: SELECT
```sql
CREATE POLICY "Public can view"
ON storage.objects FOR SELECT
USING (bucket_id = 'chat-attachments');
```

#### Policy 3: DELETE
```sql
CREATE POLICY "Users can delete own files"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'chat-attachments'
);
```

### –®–∞–≥ 3: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ bucket –ø—É–±–ª–∏—á–Ω—ã–π

1. Storage ‚Üí chat-attachments
2. Configuration ‚Üí Public bucket: **‚úÖ Enabled**

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã OpenAI –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –ø–æ URL.

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

#### –¢–µ—Å—Ç 1: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç
2. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É üìé
3. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG)
4. –ù–∞–ø–∏—à–∏—Ç–µ: "–ß—Ç–æ –Ω–∞ —ç—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏?"
5. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤ Supabase Storage
- AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `gpt-4-vision-preview` –º–æ–¥–µ–ª—å
- AI –æ–ø–∏—à–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```
üìù Created user message: {id}
üìé Uploaded file: image.jpg ‚Üí https://...
üì§ Sending to AI with attachments: ["https://..."]
```

**–õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (—Å–µ—Ä–≤–µ—Ä):**
```
üì§ Upload Request: { hasFile: true, fileName: '...', ... }
üîç AI Stream Request: { ..., attachmentUrls: ['https://...'], ... }
üñºÔ∏è Has images: true, URLs: ['https://...']
ü§ñ Using model: gpt-4-vision-preview
```

#### –¢–µ—Å—Ç 2: PDF –¥–æ–∫—É–º–µ–Ω—Ç ‚úÖ
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ PDF
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–û–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞" –∏–ª–∏ "–°–¥–µ–ª–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤ Storage
- –¢–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á–µ—Ç—Å—è –∏–∑ PDF –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- AI –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å

**–õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
```
üì§ Upload Request: { hasFile: true, fileName: 'document.pdf', fileType: 'application/pdf', ... }
üìÑ Extracting text from PDF...
‚úÖ Extracted text: [–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤]...
üìé Found attachments for message: 1
üìÑ Loaded text from document.pdf: [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ] chars
ü§ñ Using model: gpt-4
```

#### –¢–µ—Å—Ç 3: Word –¥–æ–∫—É–º–µ–Ω—Ç ‚úÖ
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ DOCX –∏–ª–∏ DOC —Ñ–∞–π–ª
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–ß—Ç–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ?" –∏–ª–∏ "–ü–µ—Ä–µ—á–∏—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
- –¢–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á–µ—Ç—Å—è –∏–∑ Word –¥–æ–∫—É–º–µ–Ω—Ç–∞
- AI –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –æ—Ç–≤–µ—Ç–∏—Ç

**–õ–æ–≥–∏:**
```
üìù Extracting text from DOCX...
‚úÖ Extracted text: ...
```

#### –¢–µ—Å—Ç 4: –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª ‚úÖ
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ .txt –∏–ª–∏ .md —Ñ–∞–π–ª
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–°—É–º–º–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
- –¢–µ–∫—Å—Ç –ø—Ä–æ—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- AI –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

**–õ–æ–≥–∏:**
```
üìÉ Reading text file...
‚úÖ Extracted text: ...
```

#### –¢–µ—Å—Ç 5: JSON —Ñ–∞–π–ª ‚úÖ
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ .json —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω—Ñ–∏–≥, –¥–∞–Ω–Ω—ã–µ API)
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–û–±—ä—è—Å–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö" –∏–ª–∏ "–ö–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å –≤ JSON?"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- JSON —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ –±—É–¥–µ—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω
- AI –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- AI –æ–±—ä—è—Å–Ω–∏—Ç –ø–æ–ª—è –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

**–õ–æ–≥–∏:**
```
üìä Reading JSON file...
‚úÖ Extracted text: JSON File:
{
  "name": "example",
  ...
}
```

#### –¢–µ—Å—Ç 6: CSV —Ñ–∞–π–ª (—Ç–∞–±–ª–∏—Ü–∞) ‚úÖ
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ .csv —Ñ–∞–π–ª (—ç–∫—Å–ø–æ—Ä—Ç –∏–∑ Excel, –¥–∞–Ω–Ω—ã–µ)
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–°—É–º–º–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã" –∏–ª–∏ "–°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫?"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- CSV –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç
- AI –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É
- AI –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–õ–æ–≥–∏:**
```
üìà Reading CSV file...
‚úÖ Extracted text: CSV File:
name,age,city
...
```

#### –¢–µ—Å—Ç 7: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –¥–æ–∫—É–º–µ–Ω—Ç) üî•
1. –ù–∞–∂–º–∏—Ç–µ —Å–∫—Ä–µ–ø–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò PDF –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. –ù–∞–ø–∏—à–∏—Ç–µ: "–û–ø–∏—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ä–µ–∑—é–º–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç"
4. –ù–∞–∂–º–∏—Ç–µ Send

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–±–∞ —Ñ–∞–π–ª–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
- AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `gpt-4o` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- AI —É–≤–∏–¥–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç PDF
- –î–∞—Å—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ—Ç–≤–µ—Ç

**–õ–æ–≥–∏:**
```
üìé Found attachments for message: 2
üìÑ Loaded text from document.pdf: [chars]
üñºÔ∏è Has images: true
ü§ñ Using model: gpt-4o (with image support)
```

## –û—Ç–ª–∞–¥–∫–∞

### –û—à–∏–±–∫–∞: 500 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- Bucket `chat-attachments` —Å–æ–∑–¥–∞–Ω
- Storage policies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (—Å–º. –≤—ã—à–µ)

### –û—à–∏–±–∫–∞: attachmentUrls –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ–π
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ `üìé Uploaded file: ...`
- –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab, –Ω–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å POST /api/upload

### –û—à–∏–±–∫–∞: CSV/JSON —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥ `üìù MIME type fallback: .csv ‚Üí text/csv` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚ùå File type not allowed` - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- **–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é, –¥–∞–∂–µ –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME —Ç–∏–ø

### AI –Ω–µ –≤–∏–¥–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- Bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ Public
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `gpt-4o (multimodal - images)` –º–æ–¥–µ–ª—å

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF (–±–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ PDF —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—É—Ç–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–º–∞–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –¢–∞–∫–∏–µ PDF —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü, –Ω–æ –ù–ï —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π.

**–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:**
- –ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–∏—Ç–µ: `‚ö†Ô∏è No text extracted from PDF (likely scanned image)`
- AI –ø–æ–ª—É—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "This PDF appears to be a scanned image without text layer"

**‚úÖ –†–ï–®–ï–ù–ò–ï:**
–í–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ PDF, **—Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (JPG –∏–ª–∏ PNG) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `gpt-4o` –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ **Vision (OCR)**
- –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ OCR
- –†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ —Ç–æ—á–Ω–æ

**–ü—Ä–∏–º–µ—Ä:**
```
‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: scanned_document.pdf (—Å–∫–∞–Ω)
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç: scanned_document.jpg –∏–ª–∏ scanned_document.png
```

### –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|-----------|------------|
| **PDF —Å —Ç–µ–∫—Å—Ç–æ–º** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è gpt-4o –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| **PDF-—Å–∫–∞–Ω** | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ JPG/PNG –¥–ª—è —á—Ç–µ–Ω–∏—è —á–µ—Ä–µ–∑ Vision |
| **DOCX/DOC** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ mammoth |
| **TXT, MD** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ |
| **JSON** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ |
| **CSV** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ß—Ç–µ–Ω–∏–µ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **XML** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **HTML** | ‚úÖ –ü–æ–ª–Ω–∞—è | –ß—Ç–µ–Ω–∏–µ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü |
| **JPG, PNG, GIF, WebP** | ‚úÖ –ü–æ–ª–Ω–∞—è + Vision | gpt-4o —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ì–û–¢–û–í–û)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF —á–µ—Ä–µ–∑ `pdf2json`
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ DOCX/DOC —á–µ—Ä–µ–∑ `mammoth`
- ‚úÖ –ß—Ç–µ–Ω–∏–µ TXT, MD —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –≤ AI –ø—Ä–æ–º–ø—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ gpt-4o (128k –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ gpt-4o Vision

### 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ attachments –≤ UI (TODO)
–°–µ–π—á–∞—Å attachments –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ ChatMessage. –ù—É–∂–Ω–æ:
- –ó–∞–≥—Ä—É–∂–∞—Ç—å attachments –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ message
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–≤—å—é –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –°—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (PDF, DOC, TXT)

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π –¥–∏–∑–∞–π–Ω:**
```
User: [–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã]
      üìÑ document.pdf (250 KB)
      üñºÔ∏è [–ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
      –û–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```

### 3. Auth (TODO)
–ö–æ–≥–¥–∞ auth –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:
- –í–∫–ª—é—á–∏—Ç—å RLS –æ–±—Ä–∞—Ç–Ω–æ
- –£–±—Ä–∞—Ç—å `anon` –∏–∑ Storage policies
- –û–±–Ω–æ–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ auth.uid()

---

**–°—Ç–∞—Ç—É—Å:** –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
